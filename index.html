<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DiscordJS #1</title>
  <link rel="shortcut icon" type="image/png" href="images/ico_full.png"/>
  <link rel="stylesheet" href="stylesheet/prism.css">
  <link rel="stylesheet" href="stylesheet/style.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body>

  <!-- Introduction -->
  <div class="banner" style="display: block !important; background-image: linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.5)), url('https://i.redd.it/gmyldjq35fy51.png');">
    <div id="class-languages">
      <i class="fab fa-html5 mr-1" style="color: #f84820"></i>
      <i class="fab fa-css3-alt mr-1" style="color: #1970b5"></i>
      <i class="fab fa-js-square mr-1" style="color: #FFE01B"></i>
    </div>
    <div class="container text-center">
      <div class="main">
        <img src="images/logo.png" alt="">
        <div class="class-title">
          <h1>DiscordJS<br> Fiche 1</h1>
        </div>
      </div>
      <p>Connais-tu Discord? Et les bots Discord? On peut les programmer en JavaScript grâce à la librarie <b>DiscordJS</b>!</p>
      <a class="btn btn-primary tl-button" href="#challenge" role="button">Commencer !</a>
    </div>
  </div>

  <div class="container" id="challenge">

    <div class="accordion" id="accordionExample">

      <!-- Étape 1 -->
      <div class="card">
        <div class="card-header" id="heading1">
          <h2 class="mb-0">
            <button class="btn btn-link done task" type="button" data-toggle="collapse" data-target="#collapse1" aria-expanded="false" aria-controls="collapse1">
              Étape 1 - Pré-requis
            </button>
          </h2>
        </div>
        <div id="collapse1" class="collapse show" aria-labelledby="heading1" data-parent="#accordionExample">
          <div class="card-body">
            <p>Avant de commencer ce défi, il te faut un certain nombre de comptes</p>
            <ol>
              <li>Pour créer un bot Discord, il va te falloir un <strong>compte Discord</strong>. Si tu n'as pas encore de compte, tu peux en créer un <a href="https://discord.com/register" target="_blank">ici</a>. Après avoir créé ton compte, le site te redirigera vers l'interface Discord.</li>
              <li>Ensuite, il faut que tu te joignes à un <strong>serveur Discord</strong> sur lequel tu pourras lâcher ton bot. On a un serveur Techies Lab que tu peux utiliser pour tester ton bot. Pour te joindre à notre serveur, clique sur le <a href="https://discord.gg/PKuDCUBBRg" target="_blank">lien suivant</a>. Une fois que c'est fait, demande à ton animateur de te donner le rôle de "Créateur de Bots". Tu en auras besoin plus tard!</li>
              <li>Finalement, on va devoir coder notre bot quelque part et pour cela, on va utiliser <strong>repl.it</strong>. Tu as peut-être déjà utilisé cette plateforme. Si ce n'est pas le cas, tu peux te créer un compte <a href="https://repl.it/signup" target="_blank">ici</a>. Si tu as déjà un compte, connecte-toi <a href="https://repl.it/login">ici</a>.</li>
            </ol>
            <p>Si tu as complété ces trois tâches, tu peux passer à l'étape 2.</p>
          </div>
        </div>
      </div>

      <!-- Étape 2 -->
      <div class="card">
        <div class="card-header" id="heading2">
          <h2 class="mb-0">
            <button class="btn btn-link done task" type="button" data-toggle="collapse" data-target="#collapse2" aria-expanded="false" aria-controls="collapse2">
              Étape 2 - Créer le Bot
            </button>
          </h2>
        </div>
        <div id="collapse2" class="collapse" aria-labelledby="heading2" data-parent="#accordionExample">
          <div class="card-body">
            <p>On va créer notre bot Discord! Pour ce faire, on doit aller sur la partie <a href="https://discord.com/developers" target="_blank">développeur de Discord</a>. Tu peux aussi trouver cette partie en allant tout en bas du site <a href="https://www.discord.com">Discord</a> et appuyer sur "Developers".</p>

            <p>Sois sûr.e d'être dans la partie "Applications". Ici, tu peux choisir "New Application" dans le coin supérieur à droite et donner un nom a ton application. Tu peux l'appeler comme tu veux.</p>

            <img src="./images/new_application.png" alt="New applications" width='100%'>

            <p>Tu peux alors voir toutes les informations de ton application et lui ajouter une icône ainsi qu'une description, si tu le souhaites. Une fois que c'est fait, n'oublie pas de sauvegarder en appuyant sur "Save Changes" en bas de l'écran.</p>

            <img src="./images/GeneralInformation.png" alt="GeneralInformation" width='100%'>

            <p>Pour que ton application devienne agisse comme un bot, il faut que tu ailles dans la section "Bot":</p>
            <img src="./images/bot_section.png" alt="Bot section">

            <p>Ici, tu peux cliquer sur "Add Bot" pour lier un bot à ton application. Tu devras confirmer en cliquant sur "Yes, do it!". Lorsque c'est fait, cherche l'option "Public Bot" et désactive-la.</p>

            <img src="./images/PublicBot.png" alt="PublicBot" width='100%'>


            <p>On va maintenant ajouter ce bot au serveur Techies. Dans la section "OAuth2/URL Generator", clique sur la case "bot" des options "SCOPES":</p>
            <img src="./images/url_generator_bot.png" alt="Scopes Bot" width='100%'>

            <p>De nouvelles options "BOT PERMISSIONS" apparaissent en bas. Coche sur "Send Messages" pour permettre à ton bot d'envoyer des messages. Ensuite appuie sur "Copy" pour copier le lien de ton bot.</p>

            <img src="./images/send_messages.png" alt="Send Messages" width='100%'>
            <p>...</p>

            <img src="./images/generated_url.png" alt="Generated URL" width='100%'>

            <p>Colle le lien de ton bot dans un nouvel onglet de ton navigateur (Chrome, Firefox, etc.). Ici, on te demandera de sélectionner un serveur sur lequel ajouter ton bot. Sélectionne le serveur Techies Lab.</p>

            <img src="./images/AddToServer.png" alt="AddToServer" width='30%'>

            <p>Tu devrais voir ton bot apparaître sur le serveur! Il ne fait rien pour l'instant, mais il est là!</p>

            <img src="./images/Welcome.png" alt="Welcome" width='60%'>
          </div>
        </div>
      </div>


      <!-- Étape 3 -->
      <div class="card">
        <div class="card-header" id="heading3">
          <h2 class="mb-0">
            <button class="btn btn-link done task" type="button" data-toggle="collapse" data-target="#collapse3" aria-expanded="false" aria-controls="collapse3">
              Étape 3 - Coder le Bot
            </button>
          </h2>
        </div>
        <div id="collapse3" class="collapse" aria-labelledby="heading3" data-parent="#accordionExample">
          <div class="card-body">
            <p>On va commencer à coder le bot. Connecte-toi à ton compte <a href="https://repl.it/~" target="_blank">repl.it</a>. Une fois sur la page, clique sur "+ Create" pour créer un nouveau projet. Comme langage, choisis "Node.js" et donne lui un nom adapté.</p>
            <img src="./images/NewRepl.png" alt="NewRepl">
            <p>...</p>
            <img src="./images/langage_name.png" alt="Language+Name" width='80%'>

            <p>Tu peux maintenant écrire du code dans la partie du milieu de l'écran. Contrairement aux projets p5.js, rien n'est écrit au départ, on va devoir tout écrire nous-mêmes!</p>

            <p>Pour commencer, écris ces deux lignes suivantes:</p>

            <pre><code class="language-js">
              const Discord = require('discord.js');
              const bot = new Discord.Client();
            </code></pre>

            <p>La première ligne importe la librairie "discord.js", qui est importante pour pouvoir coder un bot Discord. La seconde ligne crée un client Discord, qui va être l'intermédiaire entre notre code JavaScript et notre serveur Discord. Ce client est un peu comme la représentation du bot dans notre code, et on l'appelle donc <code>bot</code>.</p>

            <p>Appuie sur le bouton "Run" en haut au milieu de l'écran. Repl.it va alors installer la librairie "discord.js", ceci pourrait prendre un peu de temps. Le résultat dans la console est un message d'erreur:</p>

            <img src="./images/error_cannot_find_module.png" alt="Error cannot find module">

            <p>Par défaut, repl.it installe la dernière version (v13) de la librairie discord.js. Malheureusement, cette version n'est pas compatible avec la version de <strong>node</strong> (une autre librairie utilisée pour que notre projet JavaScript fonctionne).</p>

            <p>Pour régler ce problème, on va utiliser une version plus "ancienne" de discord.js, à savoir la version 12.5.1. Tu as peut-être remarqué qu'après avoir cliqué sur le bouton "Run", deux nouveaux fichiers étaient apparus dans ton projet:</p>
            <img src="./images/package_json.png" alt="package.json file">

            <p>Dans le fichier <code class="language-js">package.json</code>, une des lignes indique la version de la librairie <strong>discord.js</strong> qui est installée dans ton projet. Dans mon cas, c'est la version 13.6.0:</p>

            <img src="./images/dependencies.png" alt="package.json file">

            <p>Pour rétrograder la version, il suffit de remplacer la version par celle souhaitée: <code class="language-js">"discord.js": "^12.5.1"</code></p>

            <p>Clique à nouveau sur le bouton "Run". Si tu vois</p>

            <pre><code class="language-js">
              Hint: hit control+c anytime to enter REPL.
            </code></pre>

            <p>tu sais que ça a marché!</p>

            <p>On va maintenant activer le bot, c'est-à-dire le mettre en route. Pour ce faire, on va écouter le client (notre appli Discord) jusqu'à ce qu'elle nous dise qu'elle est prête (<em>ready</em> en anglais). Quand l'appli est prête, on va exécuter la fonction, qui est passée en second paramètre.</p>

            <pre><code class="language-js">
              bot.on('ready', function(){
                console.log('Connecté');
              });
            </code></pre>

            <img src="./images/params.png" alt="on function's params" width="100%">


            <p>Essaie de lancer ce code. Sais-tu pourquoi on ne voit pas "Connecté" s'afficher dans la console? C'est qu'on a pas précisé avec quel bot on voulait travailler! Pour cela, on a besoin du <em>token</em> (ou jeton d'identification) de notre bot.</p>

            <p>Va sur le portail développeur de Discord, puis sur ton application créée à l'étape 2. Dans la section "Bot", cherche la partie "Token":</p>

            <img src="./images/Token.png" alt="Token" width='30%'>

            <p>Appuie sur "Copy" pour copier ton token! On en a besoin pour se connecter au bot.</p>

            <pre><code class="language-js">
              bot.login('Ton Token');
            </code></pre>

            <p>Ajoute cette ligne après les deux premières lignes de ton projet et n'oublie pas de remplacer "Ton Token" par le token que tu viens de copier.</p>

            <p>Lorsque tu lances le code, tu devrais voir "Connecté" s'afficher dans la console!</p>

            <img src="./images/Connecté.png" alt="Connecté" width='60%'>
          </div>
        </div>
      </div>

      <!-- Étape 4 -->
      <div class="card">
        <div class="card-header" id="heading4">
          <h2 class="mb-0">
            <button class="btn btn-link done task" type="button" data-toggle="collapse" data-target="#collapse4" aria-expanded="false" aria-controls="collapse4">
              Étape 4 - Envoyer des messages
            </button>
          </h2>
        </div>
        <div id="collapse4" class="collapse" aria-labelledby="heading4" data-parent="#accordionExample">
          <div class="card-body">
            <p>On va maintenant envoyer des messages avec notre bot. Le bot qu'on va créer est très simple et sans but réel autre qu'éducatif: À chaque fois qu'un utilisateur envoie "Ping", le Bot répondra "Pong".</p>

            <p>Pour ce faire, on doit coder une façon de savoir si un message arrive ou non. On doit <b>écouter</b> si un <b>signal</b> arrive! Le signal en question est <code>'message'</code>. Te souviens tu comment faire?</p>

            <pre><code class="language-js">
              bot.on('message', ...);
            </code></pre>

            <p>On doit alors remplacer les '...' par une fonction! Faisons cela!</p>

            <pre><code class="language-js">
              bot.on('message', function() {
                // ...
              });
            </code></pre>

            <p>Dans le cas où on écoutait pour le signal <code>'ready'</code>, on avait une fonction comme celle ci. Mais ici on écoute pour le signal <code>'message'</code>, et donc un message vient avec le signal. La fonction prend donc un argument!</p>

            <pre><code class="language-js">
              bot.on('message', function(msg) {
                // ...
              });
            </code></pre>

            <p>Il ne nous reste qu'à vérifier si le contenu du message vaut "Ping", et dans ce cas on va répondre "Pong"!</p>

            <p>Pour accéder au contenu du message, on utilise <code>msg.content</code>. Donc pour vérifier si le contenu vaut "Ping", on fait le suivant:</p>

            <pre><code class="language-js">
              if(msg.content === "Ping") {
                // ...
              }
            </code></pre>

            <p>Pour envoyer un message, on a deux options. Je te recommande d'essayer les deux et de déterminer par toi même lequel tu préfères.</p>

            <ul>
              <li>
                <p>Pour répondre à l'utilisateur qui a envoyé le message, on utilise <code>msg.reply()</code></p>
                <pre><code class="language-js">
                  msg.reply("Pong");
                </code></pre>
              </li>
              <li>
                <p>Pour simplement envoyer un message dans le même canal que l'utilisateur qui a envoyé le premier message, on utilise <code>msg.channel.send()</code></p>
                <pre><code class="language-js">
                  msg.channel.send("Pong");
                </code></pre>
              </li>
            </ul>

            <p>Bravo! Ton bot est maintenant fonctionnel! Voici une liste de challenges si tu as fini à l'avance:</p>

            <ul>
              <li>Essaie de changer les mots que le bot détecte et qu'il répond.</li>
              <li>Fait en sorte que le bot réponde à différents mots. Par exemple, mon bot répond "Pong" quand je dis "Ping", et il répond "Yang" quand je dis "Yin".</li>
              <li>Rajoute beaucoup de mots différents! Pour rendre l'écriture plus facile, renseigne-toi sur ce qu'est un <code>switch</code> en JavaScript. Recherche "switch javascript" sur Google et essaie de comprendre pourquoi c'est utile ici!</li>
            </ul>
          </div>
        </div>
      </div>



    </div>
  </div>



<div class="footer">
  <div class="footer-links">
    <a href="https://techieslab.be/"><i class="fas fa-globe"></i></i></a>
    <a href="https://www.facebook.com/TechiesLabBrussels"><i class="fab fa-facebook"></i></a>
    <a href="https://www.linkedin.com/company/techies-lab/"><i class="fab fa-linkedin"></i></a>
    <a href="https://twitter.com/TechiesLab"><i class="fab fa-twitter"></i></a>
  </div>
  <div class="footer-copyright">
    <a href="https://techieslab.be" rel="noopener noreferrer" target="_blank" class="alert-link copyright">
      <i class="far fa-copyright"></i>
      2022 Techies Lab ASBL. All rights reserved.
    </a>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="javascript/prism.js"></script>
</body>
</html>
